<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bon de Commande Partenariat Noël 2024</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f9fa;
            color: #343a40;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #ffffff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        h1, h2, h3 {
            color: #007bff;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            margin-bottom: 15px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #dee2e6;
            text-align: left;
        }
        th {
            background-color: #007bff;
            color: #ffffff;
        }
        .product-total {
            text-align: right;
        }
        .order-summary {
            margin-top: 20px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
        }
        button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Bon de Commande - Partenariat Noël 2024</h1>
        <form id="order-form">
            <div class="client-info">
                <label for="reseller-class">Classe du Revendeur:</label>
                <select id="reseller-class" name="reseller-class" required>
                    <option value="">Sélectionner la classe</option>
                    <option value="6">6</option>
                    <option value="5">5</option>
                    <option value="4">4</option>
                    <option value="3">3</option>
                </select>

                <div id="class-number-container" style="display: none; margin-top: 10px;">
                    <label for="class-number">Numéro de la Classe :</label>
                    <select id="class-number" name="class-number">
                        <option value="">Sélectionner le numéro de la classe</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="client_name">Nom du client</label>
                    <input type="text" id="client_name" name="client_name" required>
                </div>

                <div class="form-group">
                    <label for="vendor_name">Nom du vendeur</label>
                    <input type="text" id="vendor_name" name="vendor_name" required>
                </div>
            </div>

            <h2>Articles à commander</h2>
            <h3>Spécialités</h3>
            <table>
                <thead>
                    <tr>
                        <th>Article</th>
                        <th>Poids</th>
                        <th>Prix Unitaire</th>
                        <th>Quantité</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <h2>Spécialités</h2>
<table>
    <tr>
        <td>Praliné Croquant - Lait</td>
        <td>210g</td>
        <td>15,90€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="15.90" class="quantity" value="0">
            <input type="hidden" name="ref_praline_lait" value="BCCGL">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Ganache au Piment d'Espelette - Noir</td>
        <td>170g</td>
        <td>14,00€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="14.00" class="quantity" value="0">
            <input type="hidden" name="ref_ganache_espelette_noir" value="EGPN170">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Ganache Nature Chocolat - Noir</td>
        <td>110g</td>
        <td>11,90€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="11.90" class="quantity" value="0">
            <input type="hidden" name="ref_ganache_nature_noir" value="PGNA110">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Ganache à la Pulpe de Cerises Noires - Noir</td>
        <td>110g</td>
        <td>11,90€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="11.90" class="quantity" value="0">
            <input type="hidden" name="ref_ganache_cerises_noires_noir" value="PGCN110">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Ganache Caramel au Sel de Salies de Béarn - Lait</td>
        <td>210g</td>
        <td>15,90€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="15.90" class="quantity" value="0">
            <input type="hidden" name="ref_ganache_caramel_lait" value="BCGG210">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
</table>

<h2>Tablettes Inspiration Terroir</h2>
<table>
    <tr>
        <td>Tablette Lait Caramel Sel de Salies de Béarn</td>
        <td>80g</td>
        <td>5,50€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="5.50" class="quantity" value="0">
            <input type="hidden" name="ref_tablette_caramel_lait" value="TLC580">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Tablette Noir Piment</td>
        <td>80g</td>
        <td>5,50€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="5.50" class="quantity" value="0">
            <input type="hidden" name="ref_tablette_noir_piment" value="TNPN80">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Tablette Noir Bayonne</td>
        <td>80g</td>
        <td>5,50€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="5.50" class="quantity" value="0">
            <input type="hidden" name="ref_tablette_noir_bayonne" value="TNBA80">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Tablette Ambrée - Blanc (nouveau)</td>
        <td>80g</td>
        <td>5,50€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="5.50" class="quantity" value="0">
            <input type="hidden" name="ref_tablette_ambree_blanc" value="TBA80">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
</table>

<h2>Gourmandises à Grignoter</h2>
<table>
    <tr>
        <td>Céréale Croustillante Chocolat - Lait</td>
        <td>110g</td>
        <td>7,70€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="7.70" class="quantity" value="0">
            <input type="hidden" name="ref_cereale_lait" value="PCL110">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Céréale Croustillante Chocolat Lait Caramel</td>
        <td>110g</td>
        <td>7,70€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="7.70" class="quantity" value="0">
            <input type="hidden" name="ref_cereale_lait_caramel" value="PCLT110">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Céréale Croustillante Chocolat - Noir</td>
        <td>110g</td>
        <td>7,70€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="7.70" class="quantity" value="0">
            <input type="hidden" name="ref_cereale_noir" value="PCN110">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Mendiant Noir Fruits Secs</td>
        <td>110g</td>
        <td>8,50€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="8.50" class="quantity" value="0">
            <input type="hidden" name="ref_mendiant_noir" value="PVMN110">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Mendiant Lait Fruits Secs</td>
        <td>110g</td>
        <td>8,50€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="8.50" class="quantity" value="0">
            <input type="hidden" name="ref_mendiant_lait" value="PMLC110">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Noisettes Lait Poudre de Cacao</td>
        <td>110g</td>
        <td>8,50€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="8.50" class="quantity" value="0">
            <input type="hidden" name="ref_noisettes_lait" value="PNLC110">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Amandes Noir Poudre de Cacao</td>
        <td>110g</td>
        <td>8,50€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="8.50" class="quantity" value="0">
            <input type="hidden" name="ref_amandes_noir" value="PNAIC110">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Pâte de Fruits - Pomme Framboise (nouveau)</td>
        <td>250g</td>
        <td>9,50€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="9.50" class="quantity" value="0">
            <input type="hidden" name="ref_pate_fruits" value="EPTOP250">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Orangette enrobée Chocolat - Noir</td>
        <td>130g</td>
        <td>11,00€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="11.00" class="quantity" value="0">
            <input type="hidden" name="ref_orangette_noir" value="PON130">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
</table>

<h2>Assortiments de Bonbons de Chocolats</h2>
<table>
    <tr>
        <td>Ballotin Festif - 24 Ganaches, Pralines, Pâtes d'Amandes - Noir</td>
        <td>230g</td>
        <td>16,70€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="16.70" class="quantity" value="0">
            <input type="hidden" name="ref_ballotin_noir" value="BACM230F">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Ballotin Festif - 24 Ganaches, Pralines, Pâtes d'Amandes - Lait</td>
        <td>230g</td>
        <td>16,70€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="16.70" class="quantity" value="0">
            <input type="hidden" name="ref_ballotin_lait" value="BACM230L">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Boîte Cadeau - 54 Ganaches, Pralines, Pâtes d'Amandes - Noir et Lait</td>
        <td>530g</td>
        <td>39,00€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="39.00" class="quantity" value="0">
            <input type="hidden" name="ref_boite_cadeau" value="BACM540">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
</table>

<h2>Chocolats de Noël</h2>
<table>
    <tr>
        <td>Ganache Épices de Noël - Noir (nouveau)</td>
        <td>110g</td>
        <td>8,10€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="8.10" class="quantity" value="0">
            <input type="hidden" name="ref_ganache_epices_noir" value="PGNN110">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Truffe au Rhum</td>
        <td>110g</td>
        <td>8,10€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="8.10" class="quantity" value="0">
            <input type="hidden" name="ref_truffe_rhum" value="PT110">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
</table>

<h2>Le Coin des Enfants</h2>
<table>
    <tr>
        <td>Moulage Sapin et sa Garniture</td>
        <td>180g</td>
        <td>11,00€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="11.00" class="quantity" value="0">
            <input type="hidden" name="ref_moulage_sapin" value="PSANP3">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
    <tr>
        <td>Mini Tablette Noël et sa Garniture</td>
        <td>110g</td>
        <td>6,50€</td>
        <td>
            <input type="number" name="quantity" min="0" data-price="6.50" class="quantity" value="0">
            <input type="hidden" name="ref_tablette_noel" value="PSANL">
        </td>
        <td class="product-total">0,00€</td>
    </tr>
</table>


            <div class="order-summary">
                <div class="total-products">
                    <h3>Total des Produits :</h3>
                    <span id="total-produits">0 produits</span>
                </div>

                <label for="payment-method">Mode de paiement:</label>
                <select id="payment-method" name="payment-method" required>
                    <option value="cash">Espèces</option>
                    <option value="cheque">Chèque</option>
                </select>

                <div id="cheque-number-container" style="display: none; margin-top: 10px;">
                    <label for="cheque-number">Numéro de Chèque :</label>
                    <input type="text" id="cheque-number" name="cheque-number" placeholder="Entrez le numéro de chèque">
                </div>

                <div class="total-amount">
                    <h3>Total Commande:</h3>
                    <span id="total-commande">0,00€</span>
                </div>
            </div>

            <!-- Ajoutez ce bouton quelque part dans votre formulaire, par exemple juste avant le bouton de soumission -->

            <button type="submit" class="submit-button">Valider</button>
        </form>
    </div>    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('order-form');
    const quantities = form.querySelectorAll('.quantity');
    const totalProduitsElement = document.getElementById('total-produits');
    const totalCommandeElement = document.getElementById('total-commande');

    // Fonction pour mettre à jour les totaux
    function updateTotals() {
        let totalProduits = 0;
        let totalCommande = 0;

        quantities.forEach(quantity => {
            const price = parseFloat(quantity.dataset.price); // Récupère le prix unitaire
            const qty = parseInt(quantity.value) || 0; // Récupère la quantité

            totalProduits += qty; // Compte le nombre total de produits
            totalCommande += qty * price; // Calcule le total de la commande

            const row = quantity.closest('tr'); // Trouve la ligne correspondante
            const productTotalElement = row.querySelector('.product-total'); // Trouve la cellule de total
            productTotalElement.textContent = (qty * price).toFixed(2) + '€'; // Met à jour le total du produit
        });

        totalProduitsElement.textContent = totalProduits + ' produits'; // Met à jour le total des produits
        totalCommandeElement.textContent = totalCommande.toFixed(2) + '€'; // Met à jour le total de la commande
    }

    // Ajoute un événement d'écoute pour chaque champ de quantité
    quantities.forEach(quantity => {
        quantity.addEventListener('input', updateTotals); // Appelle updateTotals à chaque changement
    });

    // Appelle updateTotals pour initialiser les totaux au chargement
    updateTotals();

    // Gestionnaire d'événements pour le formulaire
    form.addEventListener('submit', async (event) => {
        event.preventDefault(); // Empêche le rechargement de la page

        // Récupération des valeurs du formulaire
        const vendorName = document.getElementById('vendor_name').value;
        const clientName = document.getElementById('client_name').value;
        const paymentMethod = document.getElementById('payment-method').value;
        const chequeNumber = paymentMethod === 'cheque' ? document.getElementById('cheque-number').value : null;

        // Récupération des quantités des produits
        const productQuantities = {
            BCCGL_quantity: 0,
            EGPN170_quantity: 0,
            PGNA110_quantity: 0,
            PGCN110_quantity: 0,
            BCGG210_quantity: 0,
            TLC580_quantity: 0,
            TNPN80_quantity: 0,
            TNBA80_quantity: 0,
            TBA80_quantity: 0,
            PCL110_quantity: 0,
            PCLT110_quantity: 0,
            PCN110_quantity: 0,
            PVMN110_quantity: 0,
            PMLC110_quantity: 0,
            PNLC110_quantity: 0,
            PNAIC110_quantity: 0,
            EPTOP250_quantity: 0,
            PON130_quantity: 0,
            BACM230F_quantity: 0,
            BACM230L_quantity: 0,
            BACM540_quantity: 0,
            PT110_quantity: 0,
            PSANP3_quantity: 0,
            PSANL_quantity: 0,
        };

        // Remplir l'objet productQuantities avec les valeurs des champs de quantité
        quantities.forEach(quantityInput => {
            const productRef = quantityInput.previousElementSibling.value; // Récupère la référence du produit
            const qty = parseInt(quantityInput.value) || 0; // Récupère la quantité
            if (productRef in productQuantities) {
                productQuantities[productRef] = qty; // Assigne la quantité à la bonne clé
            }
        });

        // Calculer le total de la commande
        const totalAmount = quantities.reduce((total, quantityInput) => {
            const price = parseFloat(quantityInput.dataset.price);
            const qty = parseInt(quantityInput.value) || 0;
            return total + (price * qty);
        }, 0).toFixed(2); // Total formaté à deux décimales

        // Préparer les données à insérer
        const orderData = {
            vendor_name: vendorName,
            client_name: clientName,
            payment_method: paymentMethod,
            cheque_number: chequeNumber,
            total_amount: totalAmount,
            ...productQuantities // Ajoute les quantités des produits
        };

        // Insérer les données dans Supabase
        const { createClient } = supabase
        const _supabase = createClient('https://pjbhjhjmcxyiapzlqdpo.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBqYmhqaGptY3h5aWFwemxxZHBvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzA0NjY3MzUsImV4cCI6MjA0NjA0MjczNX0.p1nDmQ2mIpJRVZAaZIOT0db4MQZJV6V0TRILpoJ3UOs')
        console.log('Supabase Instance: ', _supabase)

        const { data, error } = await _supabase
            .from('BDCElhuyar') // Remplacez par le nom de votre table
            .insert([orderData]);

        if (error) {
            console.error('Erreur lors de l\'insertion:', error);
            alert('Erreur lors de l\'enregistrement des données.');
        } else {
            alert('Données enregistrées avec succès !');
            // Réinitialiser le formulaire si nécessaire
            form.reset();
            updateTotals(); // Réinitialiser les totaux affichés
        }
    });
});


</script>
</body>
</html>